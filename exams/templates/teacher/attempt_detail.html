{% extends "base.html" %}
{% block content %}

<h2>Attempt Detail: {{ exam.title }}</h2>

<p>
  <a href="{% url 'teacher_exam_attempts' exam.id %}">Back to attempts</a> |
  <a href="{% url 'teacher_exam_detail' exam.id %}">Back to exam</a>
</p>

<hr>

<p>
  <strong>Student:</strong> {{ attempt.user.username }}<br>
  <strong>Started:</strong> {{ attempt.started_at }}<br>
  <strong>Submitted:</strong> {{ attempt.submitted_at|default:"-" }}<br>
  <strong>Score:</strong> {{ attempt.score }} / {{ attempt.max_score }}<br>
  <strong>Percentage:</strong> {{ attempt.percentage }}%<br>
  <strong>Result:</strong>
  {% if attempt.result == "PASS" %}
    <span style="color:green; font-weight:bold;">PASS</span>
  {% else %}
    <span style="color:red; font-weight:bold;">FAIL</span>
  {% endif %}
</p>

<hr>

{% for r in rows %}
<div style="border:1px solid #ddd; padding:12px; margin:10px 0; border-radius:10px;">

  <p>
    <strong>Q{{ forloop.counter }}</strong>
    {{ r.question_text }}
  </p>

  <!-- ========================= -->
  <!-- MCQ / TRUE FALSE -->
  <!-- ========================= -->
  {% if r.qtype == "MCQ" or r.qtype == "TF" %}

    <p>
      <strong>Student answer:</strong>
      {{ r.selected.text|default:"(no answer)" }}
    </p>

    <p>
      <strong>Correct answer:</strong>
      {{ r.correct.text|default:"(not set)" }}
    </p>

  {% endif %}

  <!-- ========================= -->
  <!-- STRUCTURED QUESTION -->
  <!-- ========================= -->
  {% if r.qtype == "STRUCT" %}

    <p><strong>Student answer:</strong></p>
    <ul>
      <li><strong>Part A:</strong> {{ r.selected.part_a|default:"-" }}</li>
      <li><strong>Part B:</strong> {{ r.selected.part_b|default:"-" }}</li>
      <li><strong>Part C:</strong> {{ r.selected.part_c|default:"-" }}</li>
    </ul>

    <p><strong>Correct answer:</strong></p>
    <ul>
      <li><strong>Part A:</strong> {{ r.correct.part_a|default:"-" }}</li>
      <li><strong>Part B:</strong> {{ r.correct.part_b|default:"-" }}</li>
      <li><strong>Part C:</strong> {{ r.correct.part_c|default:"-" }}</li>
    </ul>

  {% endif %}

  <!-- ========================= -->
  <!-- RESULT -->
  <!-- ========================= -->
  <p>
    <strong>Result:</strong>
    {% if r.is_correct %}
      <span style="color:green;">✅ Correct</span>
    {% else %}
      <span style="color:red;">❌ Wrong</span>
    {% endif %}
  </p>

</div>
{% endfor %}

{% endblock %}