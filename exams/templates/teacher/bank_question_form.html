{% extends "base.html" %}
{% block content %}

<h2>{{ mode }} Question - {{ subject.name }}</h2>

<form method="post" id="bankQForm">
  {% csrf_token %}

  <!-- ✅ MAIN QUESTION FIELDS (THIS IS WHAT YOU ARE MISSING) -->
  <fieldset style="border:1px solid #ddd; padding:10px; margin-bottom:12px;">
    <legend>Question</legend>

    {{ form.text.as_p }}
    {{ form.qtype.as_p }}

    <div id="structuredBox" style="display:none; border:1px solid #eee; padding:10px; margin-top:10px; border-radius:10px;">
      <strong>Structured Answers</strong>
      {{ form.correct_part_a.as_p }}
      {{ form.correct_part_b.as_p }}
      {{ form.correct_part_c.as_p }}
    </div>
  </fieldset>

  <!-- ✅ CHOICES -->
  <fieldset id="choicesBox" style="border:1px solid #ddd; padding:10px;">
    <legend>Choices (tick ONE correct)</legend>

    {{ formset.management_form }}
    {% for f in formset %}
      <div style="border:1px solid #eee; padding:8px; margin:8px 0;">
        {{ f.as_p }}
      </div>
    {% endfor %}
  </fieldset>

  <button type="submit" class="btn btn-primary">Save</button>
</form>

<a href="{% url 'teacher_bank_question_list' subject.id %}">Back</a>

<script>
function toggleBoxes(){
  const qtypeEl = document.getElementById("id_qtype");
  if(!qtypeEl) return;

  const isStruct = (qtypeEl.value === "STRUCT");
  document.getElementById("structuredBox").style.display = isStruct ? "block" : "none";
  document.getElementById("choicesBox").style.display = isStruct ? "none" : "block";
}

document.addEventListener("DOMContentLoaded", () => {
  toggleBoxes();
  const qtypeEl = document.getElementById("id_qtype");
  if(qtypeEl) qtypeEl.addEventListener("change", toggleBoxes);
});
</script>

{% endblock %}